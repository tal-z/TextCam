<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Display Webcam Stream</title>

	<style>
	#container {
		margin: 0px auto;
	}
	#videoElement {
  	    /*filter: grayscale(100%);*/
	}
	#canvasElement {
  	    //display: none;

	}
	</style>

</head>

<body>
 <div id="container">
    <video autoplay playsinline id="videoElement"></video>
    <canvas id="canvasElement"></canvas>
 </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
var video = document.querySelector("#videoElement");

if (navigator.mediaDevices.getUserMedia) {
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(function (stream) {
      video.srcObject = stream;
      var intervalID =  setInterval(takePic, 1000/{{ FPS }});
    })
    .catch(function (err0r) {
      console.log("Something went wrong!");
    });
}

const canvas = document.querySelector('canvas');
canvas.width = 480;
canvas.height = 360;


function drawToCanvas() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
};

var intervalID =  setInterval(drawToCanvas, 2* (1000/{{ FPS }}));


function takePic() {
  var imgURL = canvas.toDataURL();
  console.log(imgURL);

  $.ajax({
      type: "GET",
      url: "/webcam2text?filepath=",
      data:{
        imageBase64: imgURL
      }
    }).done(function() {
      console.log('sent');
    });
}




</script>
</body>
</html>